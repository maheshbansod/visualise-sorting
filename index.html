<html>
  <head>
    <title>
      Sorting algorithms visualised
    </title>
    <link rel="stylesheet" href="style.css" />
  </head>
  <body>
    <div id="tooldiv">
      <div class="tool">
        Upload data: <input type="file" id="inputdatabtn" />
        <button id="randomdatabtn">Generate random data</button>
      </div>
      <div class="tool">
        Data as
        <select>
          <option>Bars</option>
          <option>Jagged curve</option>
          <option>Smooth curve</option>
          <option>Balls</option>
        </select>
      </div>
      <div class="tool">
        Alignment
        <select>
          <option>Center</option>
          <option>Bottom</option>
          <option>Top</option>
        </select>
      </div>
      <div class="tool">
        <p>Algorithm</p>
        <div class="algodiv" id="bubble">
          <span class="algo">Bubble sort</span>
          <span class="checkmark">&check;</span>
        </div>
        <div class="algodiv" id="selection">
          <span class="algo">Selection sort</span>
        </div>
        <div class="algodiv" id="insertion">
          <span class="algo">Insertion sort</span>
        </div>
        <div class="algodiv" id="quick">
          <span class="algo">Quick sort</span>
        </div>
      </div>
      <div class="tool">
        ---speed control---
      </div>
      <div class="controls">
        <button id="startbtn">START</button>
      </div>
    </div>
    <div id="main">
      <canvas id="cmain">
      </canvas>
    </div>
    <script src="sorter.js">
    </script>
    <script src="visualiser.js">
    </script>
    <script>
      var ctx = document.getElementById('cmain').getContext('2d');
      ctx.canvas.width = document.getElementById('main').offsetWidth;
      ctx.canvas.height = document.getElementById('main').offsetHeight;

      var sorter = new Sorter('bubble');
      
      var selected = document.getElementById('bubble');

      var visualiser = new Visualiser(ctx);
      visualiser.setSorter(sorter);

      generateRandomData();

      visualiser.showData();

      function generateRandomData(n=100, llim=0,ulim=100) {
        var data = Array.from({length: n}, () => Math.floor(llim+Math.random() * (ulim-llim)));
        sorter.setData(data);
      }

      document.getElementById('randomdatabtn').addEventListener('click',
        () => {
          generateRandomData(100);
          visualiser.showData();
      });

      const inputElement = document.getElementById("inputdatabtn");
      inputElement.addEventListener("change", handleFiles, false);
      function handleFiles(e) {
        var file = e.target.files[0];
        var reader = new FileReader();

        reader.onload = (function(e) {
          var data = e.target.result.split(',').map((x)=>Number(x));
          sorter.setData(data);
          visualiser.showData();
        });
        reader.readAsText(file);
      }

      Array.from(document.getElementsByClassName('algodiv')).forEach((elem)=>{
        elem.addEventListener('click', (e)=> {
          setSelectedAlgorithm(e.target.id);
        });
      });

      function setSelectedAlgorithm(algo) {
        sorter.setAlgorithm(algo);
        var checkmark = selected.removeChild(selected.lastElementChild);
        selected = document.getElementById(algo);
        selected.appendChild(checkmark);
      }

      document.getElementById('startbtn').addEventListener('click',()=>{
        visualiser.playAnim(0);

      });

    </script>
  </body>
</html>
